\documentclass{beamer}
\usepackage{mathpazo}
\usepackage[latin1]{inputenc}
\usepackage[cyr]{aeguill}
\usepackage[francais]{babel}
\usepackage[T1]{fontenc}


\usepackage{epstopdf} 
\usepackage{caption}
\usepackage{subcaption}


\usetheme{ENSLyon} 
\title[Title]{Une méthode de calibration non paramétrique pour les calorimètres de CMS}
\author[Samuel Niang]{Samuel Niang}
\date{\today}
  \setbeamersize{text margin left=5mm}
  \setbeamersize{text margin right=5mm}


% pour supprimer les symboles de navigation
\setbeamertemplate{navigation symbols}{}
\usecolortheme{ENSLyon_blue}


\begin{document}

\begin{frame}
	\titlepage
	\begin{center}
            	\includegraphics[height=1cm]{images/Logo_IPNL.jpg} 
            	\hspace{1cm}
            	\includegraphics[height=1cm]{images/Logo_CMS.png} 
		\hspace{1cm}
	 	\includegraphics[height=1cm]{images/logoens.eps}
		\hspace{1cm}
		\includegraphics[height=1cm]{images/logoucbl.eps}
        \end{center}
\end{frame}

\begin{frame}
\tableofcontents
\end{frame}

\AtBeginSubsection[]
{
  \begin{frame}
  \frametitle{Sommaire}
  \tableofcontents[currentsubsection]
  \end{frame} 
}

\section{Introduction}
\subsection{Contexte}
\begin{frame}{CMS}
	\begin{itemize}
		\item Découverte du boson de Higgs en 2012
		\item Recherche de nouvelle physique au-delà du modèle standard
		\item utilisation de détecteurs 
		\item Comment fonctionne CMS ?
	\end{itemize}
\end{frame}

\begin{frame}{Détecteur}
\begin{figure}[!h]
\begin{center}
\includegraphics[height=0.7\textheight]{images/detecteur.pdf}
\caption{Une esquisse des interactions spécifiques des particules dans une tranche transversale du détecteur CMS.}
\label{detecteur}
\end{center}
\end{figure}
\end{frame}

\subsection{Problématique}
\begin{frame}{Problématique}
	\begin{center}
	\textbf{Il nous faut connaitre l'énergie ($E_{\rm true}$) des particules qui entrent dans le détecteur}
	\end{center}
	\begin{itemize}
		\item $E_{\rm true} \neq E_{\rm ecal} + E_{\rm hcal}$
		\item non linéarité des calorimètres ECAL, HCAL
		\item besoin d'une calibration $E_{\rm calib} = f(E_{\rm ecal},E_{\rm hcal})$
	\end{itemize}
	On souhaite une calibration :
	\begin{itemize}
		\item $E_{\rm calib}$ le plus proche possible de $E_{\rm true}$
		\item Calibration non paramétrique
	\end{itemize}
	\begin{center}
	\textbf{Utilisation de particules simulées}
	\end{center}
\end{frame}

\subsection{Production de l'échantillon}
\begin{frame}{Illustration de particules simulées}
\begin{figure}[!h]
\begin{center}
\includegraphics[height=0.7\textheight]{images/pictures/testLinearRegression/LinearRegression_plot3D_training.png}
\includegraphics[height=0.7\textheight]{images/pictures/explain/ecal_eq_0.png}
\caption{\'Energie vraie $E_{\rm true}$ en fonction de l'énergie mesurée dans le ECAL, $E_{\rm ecal} \neq 0$, et de l'énergie mesurée dans le HCAL.}
\label{points}
\end{center}
\end{figure}
\end{frame}

\begin{frame}{Limitation}
\begin{figure}[!h]
    \begin{center}
        \includegraphics[height=0.7\textheight]{images/pictures/explain/limit.png}
        \caption{On place une limite à $E_{\rm ecal}+E_{\rm hcal} = \SIUnits{150}{\giga\electronvolt}$}
        \label{limite}
    \end{center}
\end{figure}
\end{frame}

\section{Méthodes de calibrations proposées}

\subsection{Calibration par régression linéaire}
\begin{frame}{Courbe de calibration dans le plan $E_{\rm ecal} = 0$}
	\begin{minipage}{0.55\textwidth}
	Modèle paramétrique :
	\begin{equation}
    		E_{\rm calib} = a_1 E_{\rm ecal} + a_2 E_{\rm hcal} + b
	\end{equation}
	Minimisation de :
	\begin{equation}
		\epsilon = \sum_{n=1}^N  \left(E_{\rm true} - a_1 E_{\rm ecal} - a_2 E_{\rm hcal} - b \right)^2
	\end{equation}
	\end{minipage}
	\begin{minipage}{0.44\textwidth}
	\includegraphics[width = \textwidth]{images/pictures/testLinearRegression/LinearRegression_plot3D_surf.eps}
	\end{minipage}
\end{frame}

\begin{frame}{La régression linéaire}
	\begin{figure}[!h]
		\begin{center}
			\includegraphics[width = \textwidth]{images/pictures/testLinearRegression/LinearRegression_calibration.png}
			\caption{Courbe de calibration dans le plan $E_{\rm ecal} = 0$.}
		\end{center}
	\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width = \textwidth]{images/pictures/testLinearRegression/LinearRegression_ecalib_over_etrue_functionof_ecal_hcal.png}
\caption{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$.}
\label{LR_ecaliboveretrue_ecal_hcal}
\end{center}
\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $E_{\rm true}$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width = \textwidth]{images/pictures/testLinearRegression/LinearRegression_ecalib_over_etrue.png}
\caption{Distribution en fonction des $E_{\rm true}$ des $E_{\rm calib}/E_{\rm true}$.}
\label{LR_ecaliboveretrue_etrue}
\end{center}
\end{figure}
\end{frame}

\subsection{Méthode non paramétrique binée}
\begin{frame}{Principe de l'algorithme}
	\begin{minipage}{0.5\textwidth}
		\begin{itemize}
			\item on découpe le plan $(E_{\rm ecal},E_{\rm hcal})$ en bins
			\item calcule la moyenne des $E_{\rm true}$ dans chaque bin $\rightarrow E_{\rm calib}$
			\item prédire une énergie de $E_{\rm calib}^i$ pour un point $(E_{\rm ecal}^i,E_{\rm hcal}^i)$ :
			\begin{itemize}
				\item on cherche le bin correspondant
				\item on retourne la valeur $E_{\rm calib}$
			\end{itemize}
		\end{itemize}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\begin{figure}[!h]
			\begin{center}
				\includegraphics[width=\linewidth]{images/pictures/testCalibrationLego/CalibrationLego_plot3D_legos.eps}
				\caption{Illustration de la calibration avec $100\times100$ bins. La hauteur d'une brique correspond à l'énergie de calibration du bin.}
				\label{legos}
			\end{center}
		\end{figure}
	\end{minipage}
\end{frame}


\begin{frame}{Courbe de calibration dans le plan $E_{\rm ecal} = 0$}
	\begin{figure}[!h]
		\begin{center}
			\includegraphics[width = \textwidth]{images/pictures/testCalibrationLego/CalibrationLego_calibration.png}
			\caption{Courbe de calibration dans le plan $E_{\rm ecal} = 0$.}
		\end{center}
	\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $E_{\rm true}$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width=\textwidth]{images/pictures/testCalibrationLego/CalibrationLego_ecalib_over_etrue.png}
\caption{Distribution en fonction des $E_{\rm true}$ des $E_{\rm calib}/E_{\rm true}$.}
\label{ecaliboveretrueCL}
\end{center}
\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width=\textwidth]{images/pictures/testCalibrationLego/CalibrationLego_ecalib_over_etrue_functionof_ecal_hcal.png}
\caption{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$.}
\label{ecaliboveretrueCL_etrue}
\end{center}
\end{figure}
\end{frame}

\subsection{Méthode des plus proches voisins : Moyenne pondérée}
\begin{frame}{Principe de l'algorithme}
	\begin{minipage}{0.5\textwidth}
Nous utilisons encore des données simulées pour effectuer la calibration : chaque particule simulée $i$ est vue comme un point d'un espace tridimensionnel possédant des coordonnées $(E_{\rm ecal}^i, E_{\rm hcal}^i,E_{\rm true}^i)$.
Pour trouver l'énergie calibrée d'un point de coordonnées $(E_{\rm ecal}^0, E_{\rm hcal}^0)$ :
\begin{itemize}
	\item on recherche ses $k$ plus proches voisins dans le plan $(E_{\rm ecal}, E_{\rm hcal})$ que nous notons $(E_{\rm ecal}^i, E_{\rm hcal}^i), i \in [|1,...,k|]$
	\item on effectue une moyenne pondérée des $E_{\rm true}^i$ de ces plus proches voisins ce qui nous donne $E_{\rm calib}^0$, l'énergie calibrée.
\end{itemize}

La moyenne pondérée va donc s'exprimer ainsi :
\begin{equation}
	 E_{\rm calib}^0 = \frac{\sum_{i=1}^k g(\vec{x}^i,\sigma) \times E_{\rm true}^i}{\sum_{i=1}^k g(\vec{x}^i,\sigma)}, \vec{x}^i = (E_{\rm ecal}^i - E_{\rm ecal}^0, E_{\rm hcal}^i-E_{\rm hcal}^0)
\end{equation}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\begin{figure}[!h]
			\begin{center}
				\includegraphics[width=\textwidth]{images/pictures/testKNN/KNN_plot3D_surf.eps}
				\caption{Surface de calibration $E_{\rm calib}$  en fonction de $E_{\rm ecal}$ et $E_{\rm hcal}$.}
				\label{surfKNN}
			\end{center}
		\end{figure}
	\end{minipage}
\end{frame}

\begin{frame}{Courbe de calibration dans le plan $E_{\rm ecal} = 0$}
	\begin{figure}[!h]
		\begin{center}
			\includegraphics[width = \textwidth]{images/pictures/testKNN/KNN_calibration.png}
			\caption{Courbe de calibration dans le plan $E_{\rm ecal} = 0$.}
		\end{center}
	\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width=\textwidth]{images/pictures/testKNN/KNN_ecalib_over_etrue_functionof_ecal_hcal.png}
\caption{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$.}
\label{ecaliboveretrueKNN_ecal_hcal}
\end{center}
\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $E_{\rm true}$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width=\textwidth]{images/pictures/testKNN/KNN_ecalib_over_etrue.png}
\caption{Distribution en fonction des $E_{\rm true}$ des $E_{\rm calib}/E_{\rm true}$.}
\label{ecaliboveretrueKNN}
\end{center}
\end{figure}
\end{frame}

\subsection{Méthode des plus proches voisins : Nettoyage gaussien}
\begin{frame}{Principe de l'algorithme}
	\begin{minipage}{0.5\textwidth}
\begin{itemize}
	\item on considère des points $(E_{\rm ecal}^{0,j}, E_{\rm hcal}^{0,j})$ où nous allons évaluer l'énergie calibrée.
	\item pour chaque $(E_{\rm ecal}^{0,j}, E_{\rm hcal}^{0,j})$ :
	\begin{itemize}
		\item on recherche ses $k$ plus proches voisins dans le plan $(E_{\rm ecal}, E_{\rm hcal})$ que nous notons $(E_{\rm ecal}^l, E_{\rm hcal}^l), l \in [|1,...,k|]$
		\item on fit les $E_{\rm ecal}^l$ par une gaussienne ce qui donne $\sigma$ et $\mu$, l'écart type et la moyenne de la gaussienne
		\item on ne conserve que les voisins dont : $\mu -c\sigma \leq E_{\rm true}^l \leq \mu + c\sigma$
		\item on effectue une moyenne pondérée une moyenne pondérée de l'énergie vraie de ces plus proches voisins, ce qui nous donne $E_{\rm calib}^{0,j}$, l'énergie calibrée 
	\end{itemize}
\end{itemize}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\begin{figure}[!h]
			\begin{center}
				\includegraphics[width=\textwidth]{images/pictures/testKNNGC/KNNGaussianCleaning_plot3D_surf.eps}
				\caption{Surface de calibration $E_{\rm calib}$  en fonction de $E_{\rm ecal}$ et $E_{\rm hcal}$.}
				\label{surfKNNGC}
			\end{center}
		\end{figure}
	\end{minipage}
\end{frame}

\begin{frame}{Courbe de calibration dans le plan $E_{\rm ecal} = 0$}
	\begin{figure}[!h]
		\begin{center}
			\includegraphics[width = \textwidth]{images/pictures/testKNNGC/KNNGaussianCleaning_calibration.png}
			\caption{Courbe de calibration dans le plan $E_{\rm ecal} = 0$.}
		\end{center}
	\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width=0.8\textwidth]{images/pictures/testKNNGC/KNNGaussianCleaning_ecalib_over_etrue_functionof_ecal_hcal.png}
\caption{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$.}
\label{ecaliboveretrueKNNGC_ecal_hcal}
\end{center}
\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $E_{\rm true}$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width=0.8\textwidth]{images/pictures/testKNNGC/KNNGaussianCleaning_ecalib_over_etrue.png}
\caption{Distribution en fonction des $E_{\rm true}$ des $E_{\rm calib}/E_{\rm true}$.}
\label{ecaliboveretrueKNNGC}
\end{center}
\end{figure}
\end{frame}

\subsection{Méthode des plus proches voisins : Fit gaussien}
\begin{frame}{Principe de l'algorithme}
	\begin{minipage}{0.5\textwidth}
\begin{itemize}
	\item on considère des points $(E_{\rm ecal}^{0,j}, E_{\rm hcal}^{0,j})$ où nous allons évaluer l'énergie calibrée.
	\item pour chaque $(E_{\rm ecal}^{0,j}, E_{\rm hcal}^{0,j})$ :
	\begin{itemize}
		\item on recherche ses $k$ plus proches voisins dans le plan $(E_{\rm ecal}, E_{\rm hcal})$ notés $(E_{\rm ecal}^i, E_{\rm hcal}^i), i \in [|1,...,k|]$
		on fit les $E_{\rm ecal}^i$ par une gaussienne ce qui donne $\sigma$ et $\mu$, l'écart type et la moyenne de la gaussienne
		\item On considère $E_{\rm calib}^{0,j} = \mu$
	\end{itemize}
\end{itemize}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\begin{figure}[!h]
			\begin{center}
				\includegraphics[width=\textwidth]{images/pictures/testKNNGF/KNNGaussianFit_plot3D_surf.eps}
				\caption{Surface de calibration $E_{\rm calib}$  en fonction de $E_{\rm ecal}$ et $E_{\rm hcal}$.}
				\label{surfKNNGF}
			\end{center}
		\end{figure}
	\end{minipage}
\end{frame}

\begin{frame}{Courbe de calibration dans le plan $E_{\rm ecal} = 0$}
	\begin{figure}[!h]
		\begin{center}
			\includegraphics[width = \textwidth]{images/pictures/testKNNGF/KNNGaussianFit_calibration.png}
			\caption{Courbe de calibration dans le plan $E_{\rm ecal} = 0$.}
		\end{center}
	\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $E_{\rm true}$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width=\textwidth]{images/pictures/testKNNGF/KNNGaussianFit_ecalib_over_etrue.png}
\caption{Distribution en fonction des $E_{\rm true}$ des $E_{\rm calib}/E_{\rm true}$.}
\label{ecaliboveretrueKNNGF}
\end{center}
\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$}
\begin{figure}[!h]
\begin{center}
\includegraphics[width=\textwidth]{images/pictures/testKNNGF/KNNGaussianFit_ecalib_over_etrue_functionof_ecal_hcal.png}
\caption{$E_{\rm calib}/E_{\rm true}$ en fonction de $(E_{\rm ecal},E_{\rm hcal})$.}
\label{ecaliboveretrueKNNGF_ecal_hcal}
\end{center}
\end{figure}
\end{frame}

\section{Comparaisons et résultats}
\begin{frame}{$E_{\rm calib}/E_{\rm true}$ moyens en fonction de $(E_{\rm ecal},E_{\rm hcal})$}
\begin{figure}
\begin{center}
\begin{subfigure}{0.31\textwidth}
\includegraphics[width=\textwidth]{images/pictures/comparisons/ecaliboveretrue_LinearRegression.png}
\caption{Régression linéaire}
\end{subfigure}
\begin{subfigure}{0.31\textwidth}
\includegraphics[width=\textwidth]{images/pictures/comparisons/ecaliboveretrue_CalibrationLego.png}
\caption{Méthode non paramétrique binée}
\end{subfigure}
\begin{subfigure}{0.31\textwidth}
\includegraphics[width=\textwidth]{images/pictures/comparisons/ecaliboveretrue_KNN.png}
\caption{Plus proches voisins}
\end{subfigure}
\end{center}
\caption{Chaque pixel correspond à la moyenne d'un fit gaussien de points $E_{\rm calib}/E_{\rm true}$ proches des coordonnées du pixel pour les particules qui interagissent avec le ECAL et le HCAL.}
\label{comparaison2}
\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ moyens en fonction de $(E_{\rm ecal},E_{\rm hcal})$}
\begin{figure}
\begin{center}
\begin{subfigure}{0.31\textwidth}
\includegraphics[width=\textwidth]{images/pictures/comparisons/ecaliboveretrue_KNN.png}
\caption{Plus proches voisins - Moyenne pondérée}
\end{subfigure}
\begin{subfigure}{0.31\textwidth}
\includegraphics[width=\textwidth]{images/pictures/comparisons/ecaliboveretrue_KNNGaussianCleaning.png}
\caption{Plus proches voisins - Nettoyage gaussien}
\end{subfigure}
\begin{subfigure}{0.31\textwidth}
\includegraphics[width=\textwidth]{images/pictures/comparisons/ecaliboveretrue_KNNGaussianFit.png}
\caption{Plus proches voisins - Fit gaussien}
\end{subfigure}
\end{center}
\caption{Chaque pixel correspond à la moyenne d'un fit gaussien de points $E_{\rm calib}/E_{\rm true}$ proches des coordonnées du pixel pour les particules qui interagissent avec le ECAL et le HCAL.}
\label{comparaison2}
\end{figure}
\end{frame}

\begin{frame}{$E_{\rm calib}/E_{\rm true}$ moyens en fonction de $E_{\rm true}$}
\begin{figure}[!h]
\centering
\includegraphics[height=0.75\textheight]{images/pictures/comparisons/comparison2.eps}
\caption{$E_{\rm calib}/E_{\rm true}$ moyens en fonction de $E_{\rm true}$ dans les cas $E_{\rm ecal} = 0$et $\sigma$ du fit gaussien correspondant.}
\label{comparaison3}
\end{figure}
\end{frame}


\section{Conclusion}
\begin{frame}{Conclusion}
Les méthodes des plus proches voisins avec un nettoyage gaussien ou avec un fit gaussien permettent de calibrer l'énergie des particules pour estimer correctement l'énergie vraie des particules en fonction de leur dépôts d'énergie dans les calorimètres ECAL et HCAL. 

Comparées à la régression linéaire, les méthodes proposées sont plus avantageuses car elles prennent en compte ce qui se passe localement et ne cherchent pas à donner une fonction générale pour déterminer $E_{\rm calib}$ en fonction de $E_{\rm ecal}$ et $E_{\rm hcal}$ et on constate qu'elles fournissent des énergies de calibrations plus proches de la réalité comparées à la régression linéaire. 
Cependant, ces méthodes restent à améliorer, notamment en ce qui concerne la calibration pour les particules de faible énergie. 

\'Egalement, d'autres points seront seront à développer par la suite. En effet, il faudrait être capable d'extrapoler une énergie de calibration pour des particules de plus hautes énergies. De plus il faudrait prendre en compte plus d'informations comme par exemple l'angle de la trajectoire des particules. Et enfin, il faudrait comparer avec la calibration utilisée actuellement par CMS pour le particle flow qui se base sur une fonction paramétrée.

\small
\textit{
Tous les codes développés durant le stage sont consultables sur la plateforme Github :\\
\href{https://sniang.github.io/particle\_flow\_calibration/}{https://sniang.github.io/particle\_flow\_calibration}.
}
\end{frame}

\end{document}
